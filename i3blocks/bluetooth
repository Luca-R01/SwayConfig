#!/bin/bash

STATUS=$(bluetoothctl show | grep "Powered:" | awk '{print $2}')
DEVICES=$(bluetoothctl info | grep "Device" | awk '{print $2}')

if [ "$STATUS" = "yes" ]; then
    COLOR="#FFFFFF"
    ICON="󰂯"
else
    COLOR="#FF0000"
    ICON="󰂲"
fi

# Output
echo "$ICON" && echo "" && echo "$COLOR"

# Mouse click event
case $BLOCK_BUTTON in
    1)
        if [ "$STATUS" = "no" ]; then
            bluetoothctl power on >/dev/null 2>&1 && notify-send "Bluetooth attivato"
        else
            bluetoothctl power off >/dev/null 2>&1 && notify-send "Bluetooth disattivato"
        fi
    ;;
    3)
        MESSAGE=""
        while read -r DEVICE; do
            NAME=$(bluetoothctl info "$DEVICE" | grep "Name" | cut -d ":" -f 2- | xargs)
            if [ -n "$NAME" ]; then
                MESSAGE="$MESSAGE$NAME ($DEVICE)\n"
            fi
        done <<< "$DEVICES"
        notify-send "$(echo -e "$MESSAGE" | sed '/^$/d')" # Rimuove linee vuote
    ;;
esac

